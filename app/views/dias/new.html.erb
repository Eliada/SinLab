<%= nested_form_for(@dia, :url => :dias, :method => :post) do |f| %>
  <%= hidden_field_tag :data, @data %>
  <%= hidden_field_tag :dia_id, @dia.id %>
  <%= hidden_field_tag :usuario_id, @usuario.id %>

  <div class="container">
    <div class="row">
      <div class="col-md-2">
          <%= f.fields_for :horarios do |horario_form| %>
            <%= horario_form.label :entrada %>
            <br />
            <%= horario_form.time_select :entrada, {minute_step: 5}, :style => 'width: 55px;', :onchange => "recalculaHoras()", :class => 'horario_select entrada_horario' %>
            <br />
            <%= horario_form.label :saida %>
            <br />
            <%= horario_form.time_select :saida, {minute_step: 5}, :style => 'width: 55px;', :onchange => "recalculaHoras()", :class => "horario_select saida_horario" %>
            <br />
          <% end %>
           
          <%= f.link_to_add 'Novo horário' , :horarios, :class=>"nohover" %>
       
        <br /><br />
          Intervalo:
          <div id="dia_intervalo"> <%= @dia.formata_intervalo %> horas </div>
       <br/>
          Total de horas:
          <div id="horas_do_dia"> <%= @dia.formata_horas  %> horas </div>
          <br/>
          Horas em atividades:
          <div id="horas_atividades"> <%= @dia.horas_atividades_todas  %> horas </div>
      </div>
      <div class="col-md-5">
        <h3 id="atividades-title">Atividades</h3>
        <div class="trello-dropover" id="dropover" ondrop="dropCard(event)" ondragover="allowDrop(event)">
          &nbsp;Arraste cartões do Trello aqui.
        </div>
        <div class="panel-scrollable" id="atividade-panel">
          <%= f.fields_for :atividades, :allow_destroy => true do |atividade_form| %>
            <div id="atividade-form">
              <%= atividade_form.link_to_remove '<i class="icon-trash icon-2x"> </i>'.html_safe,
                :class=>"nohover", :style => "float: right; margin-right: 10px" %>
              <% unless atividade_form.object.mensagem.blank?  %>
                <div class="red-background activity-message">
                  <%= atividade_form.object.avaliador.try(:nome) %>: <br/>
                  <%= atividade_form.object.mensagem %>
                </div>
              <% end %>
              <%= atividade_form.label :projeto_id, :class => 'inline-label' %>
              <%= atividade_form.select :projeto_id, options_for_select(@projetos, atividade_form.object.projeto_id),
              {}, {:class=>"projeto-seletor", :onchange => "filterCards(this);"}%>
              <br/>

              <div class="slider slider-horas">
                <%= atividade_form.label :horas, "Tempo gasto na atividade", :class => 'inline-label' %>
                <%= atividade_form.hidden_field :horas, :class => 'hora_field atividade_field'%>
                <div id="time"> </div>
                <div id="slider"> </div>
              </div>
              <%= atividade_form.hidden_field :trello_id, :class => 'cartao_field'%>

              <%= atividade_form.fields_for :pares, :allow_destroy => true do |par| %>
                <div class="par">
                  <%= par.select :par_id, options_for_select(@equipe, par.object.par_id) %>
                  <%= par.link_to_remove '<i class="icon-trash icon-2x"> </i>'.html_safe,
                    :class=>"nohover", :style => "float: right; margin-right: 10px" %>
                  <div class="slider slider-par">
                    <%= par.hidden_field :horas, :class => 'hora_field'%>
                    <div id="time"> </div>
                    <div id="slider"> </div>
                  </div>
                </div>
              <% end %>
              <%= atividade_form.link_to_add "Inserir par", :pares %> <br/>
              <%= link_to('Inserir Observação para Esta Atividade','javascript:void(0)', {:id => 'inserir_observ',
                  :style => "margin: 20px 0px" , :onclick => 'toggleObservacao(this)'}) %>
              <%= atividade_form.text_area :observacao, :style => "width: 85%; height: 40px; display: none" %>
              <div class="grey-line"> </div>
            </div>
          <% end %>
          <%= f.link_to_add "Nova Atividade", :atividades, :class=>"btn default-button",
            :style => "display: none", :id => "nova_atividade" %>
        </div>
      </div>
      <div class="col-md-5">
        <div class="loggedin">
          <a id="collapse-button" data-toggle="collapse" data-target="#boards">
            Boards do Trello
          </a>
          <div class="collapse in" id="boards">
            <div class="row">
              <% @projetos_boards.each_with_index do |board, index| %>
                <div class="col-md-4">
                  <%= check_box_tag board[0], board, false, onclick: "filterCards(this)"  %>
                  <%= hidden_field_tag :board_id, board[0], :class => "board-placeholder" %>
                </div>
                <% if (index + 1) % 3 == 0%>
                </div>
                <div class="row">
                <% end %>
              <% end %>
            </div>
          </div>
          <div class="panel-scrollable" id="output" ></div>
        </div>
      </div>
    </div>
  </div>
  <div id="lower-bar" class="navbar-fixed-bottom toolbar">
    <div style="width: 100%">
      <div class="actions" style="float: left; margin-left: 10px;">
        <!-- xi -->
        <%= hidden_field_tag :key  %>
        <%= hidden_field_tag :token  %>
        <%= f.submit "Ok", :class => "btn default-button", :onclick => "return validateSliders()" %>
      </div>
    </div>
  </div>
<% end %>

