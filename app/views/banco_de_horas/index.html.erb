<div class="row-fluid" style="margin-left: 15px">
  <div class="span2 blue-text">
    <%= link_to '<i class="icon-double-angle-left"></i>'.html_safe, banco_de_horas_path(:year => @year.to_i - 1,
      :month => @month.numero) %>
    <%= link_to @year, show_mes_banco_de_horas_path(:year => @year) %>
    <%= link_to '<i class="icon-double-angle-right"></i>'.html_safe, banco_de_horas_path(:year => @year.to_i + 1,
      :month => @month.numero) %>
  </div>
  <div class="span3 blue-text">
    <%= link_to '<i class="icon-double-angle-left"></i>'.html_safe, banco_de_horas_path(:year =>
        (@month.numero == 1) ? @year.to_i - 1 : @year.to_i, :month => (@month.numero == 1) ? 12 : @month.numero - 1) %>
    <%= t("date.month_names")[@month.numero] %>
    <%= link_to '<i class="icon-double-angle-right"></i>'.html_safe, banco_de_horas_path(:year =>
        (@month.numero == 12) ? @year.to_i + 1 : @year.to_i, :month => (@month.numero == 12) ? 1 : @month.numero + 1) %>
  </div>
</div>

<div class="blue-line">  </div>

<table class="list-table days-table" id="ausencias" style="display: none">
  <tr>
    <th>Dia</th>
    <th style="width: 60%">Justificativa </th>
    <th>Abonada?</th>
    <th></th>
  </tr>

  <% @ausencias.each do |ausencia| %>
    <tr>
      <td style="width: 11%">
        <%= "#{ausencia.dia.to_s}  (#{t("date.abbr_day_names")[Date.new(@year.to_i,
        @month.numero, ausencia.dia).wday]})"%>
      </td>
      <td>
        <%= ausencia.justificativa %>
      </td>
      <td>
        <% if ausencia.abonada? %>
          <i class="icon-ok"></i>
        <% else %>
          <i class="icon-remove"></i>
        <% end %>
      </td>
      <td>
        <%= form_tag( { :controller => :ausencias, :action => :ausencia, :id => ausencia.id },
          {:remote => true, :method => :post, :class => "inline-form"} ) do %>
          <%= hidden_field_tag :user_id, @user.id %>
          <%= hidden_field_tag :mes, @month.id %>
          <%= link_to_submit ' ', :class => 'icon-edit nohover', :style => "margin-right: 10px", :title => "Editar" %>
        <% end %>
        <%= link_to '<i class="icon-trash"> </i>'.html_safe,
          ausencia_path(ausencia.id), :method => :delete, :confirm => t("prompt.exclusao.confirmacao"),
          :class => 'nohover', :title => "Excluir"%>
      </td>
    </tr>
  <% end %>
  <tr style="border-top:thin solid; border-color:black">
    <td colspan=3>Horas totais de faltas abonadas </td>
    <td><%= (@month.blank?)? "00:00" : @month.horas_ausencias_abonadas %></td>
  </tr>
</table>

<table class="list-table days-table" id="meses">
  <tr>
    <th>Dia</th>
    <th>Entrada</th>
    <th>Saída</th>
    <th>Intervalo</th>
    <th style="padding-left: 25px;"><%= t('atividades.title') %></th>
    <th>Horas Aprovadas</th>
    <th></th>
  </tr>
  <% @dias.each do |dia| %>
    <tr>
      <td style="width: 11%"><%= "#{dia.numero.to_s}  (#{t("date.abbr_day_names")[Date.new(@year.to_i,
        @month.numero, dia.numero).wday]})"%></td>
      <td><%= dia.entrada.strftime("%H:%M") %></td>
      <td><%= dia.saida.strftime("%H:%M") %></td>
      <td><%= dia.intervalo.strftime("%H:%M") %></td>
      <td style="width: 60%; border: none">
        <% dia.atividades.each do |atividade| %>
          <div id="<%= 'atividade' + atividade.id.to_s %>" class="<%= atividade.cor_status %>">
            Observação: <br/>
            <%=  atividade.observacao%>
            <br />
            <% atividade.cartoes.each do |cartao| %>
              <input type="hidden" class="card-placeholder" id="<%= cartao.cartao_id %>" value="<%= cartao.duracao %>"></input>
            <% end %>
          </div>
        <% end %>
      </td>
      <td style="padding: 22px" <%= 'class="red-background"' if dia.horas_atividades_formato != dia.formata_horas %>>
        <%= dia.horas_atividades_formato + "h" %>
      </td>
      <td style="width: 13%;">
         <%= link_to ' ', new_dia_path(:user_id => @user.id, :ano => @year, :mes => @month.id, :id => dia.id), :class => 'icon-edit nohover'%>

        <%= link_to '<i class="icon-trash"> </i>'.html_safe,
          dia_path(dia.id), :method => :delete, :confirm => t("prompt.exclusao.confirmacao"),
          :class => 'nohover', :title => "Excluir"%>
        <% if dia.tem_reprovacao? %>
          <i class="icon-envelope" title="<%= dia.formata_mensagens %>" style="float: right; color:#FF9393"></i>
        <% end %>
      </td>
    </tr>
  <% end %>
  <tr style="border-top:thin solid; border-color:black">
    <td colspan=5>Total incluindo faltas abonadas </td>
    <td style="padding: 22px"><%= (@month.blank?)? "00:00" : @month.horas_trabalhadas_aprovadas %>h</td>
  </tr>
</table>
<br />
<br />
<div class=" container-fluid navbar-fixed-bottom toolbar">
  <div class="row-fluid">
    <div class="span7">

      <%= link_to 'Registrar atividades', new_dia_path(:user_id => @user.id, :ano => @year, :mes => @month_num), :class => 'btn default-button'%>

      <%= form_tag({ :controller => :ausencias, :action => :ausencia, :id => nil },
        {:remote => true, :method => :post, :class => "inline-form"}) do %>
        <%= hidden_field_tag :user_id, @user.id %>
        <%= hidden_field_tag :mes, @month.id %>
        <%= submit_tag 'Registrar ausência', :class => 'btn default-button'%>
      <% end %>
      <%= link_to "Ver meses", "#", :onclick => "toggleMeses()", :class => 'btn default-button',
        :id => "meses-button", :style => "display: none"%>
      <%= link_to "Ver ausências", "#", :onclick => "toggleAusencia()", :class => 'btn default-button',
        :id => "ausencias-button"%>
      <%= link_to 'Voltar', :back, :class => "btn default-button"%>
    </div>
    <div class="span5">
      <% m = Date.new(@year.to_i, @month.numero, 1) %>
      <% today = Date.today %>
      <% if m.month == today.month and m.year == today.year and !@month.blank?%>
        <div style="float: right">
          Resta(m) <b> <%= @month.horas_restantes %> </b> hora(s) de trabalho e
          <b> <%= @month.dias_uteis_restantes %> </b> dia(s) útei(s) para concluir a meta do mês <br/>
          Trabalhe <b> <%= @month.horas_a_fazer_por_dia %> </b> hora(s) por dia útil para comprir a meta
        </div>
      <% end %>
    </div>
  </div>
</div>


<div id="segundapramim" class="modal hide fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" style="width: 40%; margin-left: -20%; height: 250px">

</div>
