<div class="blue-text" style="margin-left: 30px">
  <%= t("funcionalidade.validacao.atividade")%>
</div>

<div class="row-fluid" style="margin-left: 15px">
  <div class="span2 blue-text">
    <%= link_to '<i class="icon-double-angle-left"></i>'.html_safe, validar_banco_de_horas_path(:ano => @ano.to_i - 1, :mes => @mes_numero, :usuario_id => params[:usuario_id]) %>
    <%= link_to @ano, show_mes_banco_de_horas_path(:ano => @ano) %>
    <%= link_to '<i class="icon-double-angle-right"></i>'.html_safe, validar_banco_de_horas_path(:ano => @ano.to_i + 1, :mes => @mes_numero, :usuario_id => params[:usuario_id]) %>
  </div>

  <div class="span3 blue-text">
    <%= link_to '<i class="icon-double-angle-left"></i>'.html_safe, validar_banco_de_horas_path(:ano => @ano.to_i, :mes => @mes_numero.to_i - 1, :usuario_id => params[:usuario_id]) %>
    <%= t("date.month_names")[@mes_numero.to_i] %>
    <%= link_to '<i class="icon-double-angle-right"></i>'.html_safe, validar_banco_de_horas_path(:ano => @ano.to_i, :mes => @mes_numero.to_i + 1, :usuario_id => params[:usuario_id]) %>
  </div>

</div>

<div class="row-fluid">
  <div class="span2">
    <%= select_tag(:user_select, options_for_select(@usuarios, @usuario), {:class => 'menu_select'}) %>
    </div>
  <div class="span2">
    <%= select_tag(:projeto_select, options_for_select(@projetos, @projeto), {:class => 'menu_select'}) %>
  </div>
  <div class="span4">
    <%= button_tag('Filtra', {:type => 'button', :id => 'filtra', :class => 'btn default-button'}) %>
  </div>
  <div class="span4" style="font-size:150%">
    <b><%=@total_horas%> horas ainda não aprovadas </b>
  </div >
</div>

<div class="blue-line">  </div>

<%= form_tag(mandar_validacao_banco_de_horas_path) do %>
  <div class="navbar-fixed-bottom toolbar">
    <%= submit_tag "Salvar", :class => "btn default-button"%>
  </div>
  <table class="list-table">
    <tr>
      <th> Dia        </th>
      <th> Usuário    </th>
      <th> Projeto    </th>
      <th> Detalhes   </th>
      <th> horas      </th>
      <th> aprovado?  </th>
      <th> reprovado? </th>
      <th> mensagem   </th>
    </tr>

    <% @atividades.each do |atividade| %>
      <tr <%= "class=red-background" if atividade.aprovacao == false                       %> >
        <%= hidden_field_tag "atividades[#{atividade.id}[id]]",atividade.id                %>
        <td><%= atividade.data.strftime("%d")                                              %></td>
        <td><%= atividade.usuario.nome                                                     %></td>
        <td><%= atividade.projeto.nome                                                     %></td>
        <td><%= atividade.observacao                                                       %></td>
        <td><%= atividade.formata_duracao                                                  %></td>
        <td><%= check_box_tag "atividades[#{atividade.id}[aprovacao]]", true, false, :onchange => "correctCheck(this.id,'atividades_#{atividade.id}_reprovacao')" %></td>
        <td><%= check_box_tag "atividades[#{atividade.id}[reprovacao]]", true, (atividade.aprovacao == false), :onchange => "correctCheck(this.id,'atividades_#{atividade.id}_aprovacao')"  %></td>
        <td><%= text_field_tag "atividades[#{atividade.id}[mensagem]]", atividade.mensagem %></td>
      </tr>
    <% end %>
  </table>
<% end %>
<br />
<br />

<script>
  $('#filtra').click(function() { location.href = "/banco_de_horas/validar?mes=<%= @mes_numero%>&ano=<%=@ano%>&usuario_id=" + $('#user_select').val()+"&projeto_id="+ $('#projeto_select').val() });
</script>
