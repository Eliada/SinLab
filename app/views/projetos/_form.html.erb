<%= javascript_include_tag :defaults, "nested_form" %>
<%= nested_form_for(@projeto, :validate => true, :html => {"data-type" => :json}) do |f| %>

<div class="div_edit">
    <div class="form-group">
      <h3> Dados do Projeto </h3>
      <div class="container-fluid">
        <div class="row-fluid">
          <div class=" span6">
            <%= f.label :nome %>
            <%= f.text_field :nome, :style => "width: 100%"%>

            <%= f.label :descricao %>
            <%= f.text_area :descricao, :style => "height: 80px; width: 100%"%>
          </div>
          <div class="offset1 span5">
            <%= f.label :data_de_inicio %>
            <%= f.date_select :data_de_inicio, {}, :style => "width: 100px" %>

          </div>
        </div>
      </div>
    </div>
        <div class="form-group">
      <h3> Relacionamento de projetos </h3>
      <div class="container-fluid">
        <div class="row-fluid">
          <div class=" span6">
            <table>
              <tr>
                <th><%= f.label "Super-Projeto" %></th>
                <th style="padding: 0px 20px;"><%= f.label "Sub-Projeto"%></th>
              </tr>
              <tr>
                <td><%= radio_button_tag :super_projeto, true, @eh_super_projeto%></td>
                <td style="padding: 0px 20px;"><%= radio_button_tag :super_projeto, false, !@eh_super_projeto%></td>
              </tr>
            </table>
          </div>

            <div id="filhos">
              <table>
                <tr>
                  <th><%= f.label "filho?", :style => "margin-right: 20%"%></th>
                  <th><%= f.label "projetos filhos" %>                     </th>
                </tr>
                <% @filhos_for_select.each_with_index do |sub, index| %>
                  <tr>
                    <td><%= check_box_tag "sub_projetos[#{index}[filho]", 1, !(@projeto.sub_projetos[index].nil?) %>    </td>
                    <td><%=@filhos_for_select[index][0]%><%= hidden_field_tag "sub_projetos[#{index}[id]]", @filhos_for_select[index][1], :style => "margin-right: 50%"%></td>
                  </tr>
                <%end%>
              </table>
            </div>

            <div class="offset1 span5" id="pai">
              <%= f.label "projeto pai" %>
              <%= f.select :super_projeto_id, options_for_select(@pais_for_select, [@projeto.super_projeto.try(:nome), @projeto.super_projeto_id]), :style => "width: 70%"%>
            </div>

        </div>
      </div>
    </div>
    <div class="form-group">

      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span5">
            <h3> Equipe </h3>
            <input type='text' data-provide="typeahead" class='typeahead' id='autocomplete_field'/>
            <%= f.link_to_add '<i class="icon-plus-sign icon-2x"> </i>'.html_safe , :workons, :class=>"nohover" %>
            <table>
              <tr>
                <th style="padding: 0px 20px;"> Nome </th>
                <th> Remover </th>
                <th></th>
              </tr>
              <%= f.fields_for :workons, :wrapper => false do |worker| %>
                <tr>
                  <td style="padding: 0px 20px;">
                    <%= worker.object.try(:usuario).try(:nome) %>
                    <%= worker.hidden_field :usuario_id %>
                  </td>
                  <td style="margin-left: 10px">
                    <%= worker.link_to_remove '<i class="icon-trash icon-2x"> </i>'.html_safe, :class=>"nohover" %>
                  </td>
                  <td>
                    <%= link_to "Adicionar Coordenadores", edit_workon_path( Workon.select(:id).joins(:usuario).where(:usuario => {:nome => worker.object.usuario.try(:nome)},:projeto_id => @projeto.id ).collect { |u| u.id }) %>
                  </td>
                </tr>
              <% end %>
              <tr id='novo_item'></tr>
            </table>
          </div>
          <div class="offset2 span3">

            <h3> Boards do Trello </h3>
            <div class="loggedout">
              <a class="btn default-button" id="connectLink" onclick="loginTrello(getBoards)"> Conectar ao Trello</a>
            </div>
            <div class="loggedin">
              <div id="output" class="panel-scrollable" style="height: 200px"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="actions">
      <%= f.submit "Salvar", :class => "btn default-button"%>
      <%= link_to "Cancelar", projetos_path, :class => "btn default-button" %>
    </div>
  </div>
<% end %>

<script>
  var segundaPraMim = <%= @projeto.boards.collect {|b| b.board_id}.to_json.html_safe %>;
  var u = <%= @usuarios.collect {|u| u.nome}.to_json.html_safe %>;
  var url = "<%= get_id_by_nome_usuarios_path %>";
</script>

